
---
title: "FastMapping report"
params:
  input: NA
  output: NA
output:
  pdf_document:
    toc: yes
    toc_depth: '2'
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    df_print: tibble
  word_document:
    toc: yes
    toc_depth: '2'
editor_options: 
  chunk_output_type: console
---

```{r, setup, echo=FALSE}
library(knitr)
library(ggplot2)

#        ##Data statistics
# DescrStatistics <- function (DataF) {
#   NumberOfData<-length(DataF)
#   Median <- median(DataF,  na.rm = TRUE)
#   Mean <- mean(DataF, na.rm = TRUE) 
#   Minim <- min(DataF, na.rm = TRUE) 
#   Maxim <- max(DataF, na.rm = TRUE) 
#   StDev <- sd(DataF, na.rm = TRUE)
#   DescrSt<-round(c("Number of data points" = NumberOfData,
#              "Median" = Median,
#              "Mean" = Mean,
#              "Minimum" = Minim,
#              "Maximum" = Maxim,
#              "Standard deviation" = StDev),2)
#   return(DescrSt) }
# TablaResumen<-cbind(
#   #Raw Data Statistics
#   "Raw Data" = DescrStatistics(DatosProcedimientoOriginales[,3] ),
#   #Filtered data
#   "Filtered data" = DescrStatistics(DatosUtilizadosProcedSinOutliers_Inlierns[,3])
# )
# table(addNA(CondicFinal[,4]))



myChoice <- list(Exponential ="Exp",
                 Shperical = "Sph",
                 Gaussian = "Gau",
                 Matern = "Mat",
                 "M. Stein's" ="Ste",
                 Circular = "Cir",
                 Linear = "Lin",
                 Power = "Pow",
                 Wave = "Wav",
                 Pentaspherical = "Pen",
                 Hole = "Hol")


knitr::opts_chunk$set(echo = FALSE)
```


```{r, eval = FALSE}
params


structure(params)
```


`r if(!is.null(params$output$Tabla)){"# Summary of Data"}`

`r if(!is.null(params$output$Tabla)) {ifelse(!is.null(params$output$DataDep),"Summary of data before depuration","Summary of data")}`

```{r, eval=!is.null(params$output$Tabla)}
#Si existe la tabla 
TablaOriginal <- params$output$Tabla
Coordenadas <- c(params$input$xmapa,params$input$ymapa)
VariablesTarget <- params$input$rto

kable(summary(TablaOriginal[VariablesTarget]))

if(length(VariablesTarget)==1){boxplot(TablaOriginal[VariablesTarget], las=1, col="#FFBF00")}

```


`r if(!is.null(params$output$DataDep)){"Summary of data after depuration"}`

```{r, eval=!is.null(params$output$DataDep)}

#Si existe la tabla depurada
TablaOriginalDep <- params$output$DataDep

TablaOriginalDep <- TablaOriginalDep[TablaOriginalDep$Condition=="NormalPoint",]

Coordenadas <- c(params$input$xmapa,params$input$ymapa)
VariablesTarget <- params$input$rto

kable(summary(TablaOriginalDep[VariablesTarget]))
try(
if(length(VariablesTarget)==1){boxplot(TablaOriginalDep[VariablesTarget], las=1, col="#FFA700")}
)
```



`r if(sum(!do.call(rbind, lapply(params$output, is.null)))==1) {"You dont run a procedure"}`

`r if(!is.null(params$output$MiKrige)) {cat("##Interpolation result")}`

```{r, eval=!is.null(params$output$MiKrige), results='asis'}
# names(params$output)


if(length(params$output$SelectedMdls)>1) {
  cat(paste(names(myChoice[myChoice %in% params$output$SelectedMdls ]), collapse = ", "),"models were adjusted. \n\n\n")
} else {cat(names(myChoice[myChoice %in% params$output$SelectedMdls ]),"model were adjusted. \n\n\n")}


kable(params$output$MiKrige)


plot(params$output$Variograma)
#   # ValoresOutput <- reactiveValues(Tabla=NULL, TablaCoordTrans=NULL,DataDep=NULL,NombresCol=NULL,
#   #                                 SelectedMdls=NULL,  MiKrige=NULL,
#   #                                 Variograma=NULL, Mygr=NULL, kriging=NULL, GeoTiff=NULL,
#   #                                 Clasificacion=NULL, GraficoConglom=NULL)
# # browser()
if(!is.null(params$output$kriging)) plot(params$output$kriging)
# if(!is.null(params$output$GeoTiff)) plot(params$output$GeoTiff)
# if(!is.null(params$output$Clasificacion)) plot(params$output$Clasificacion)
```



`r if(!is.null(params$output$Clasificacion)) {cat("# Clasification result")} `

```{r, eval=!is.null(params$output$Clasificacion)}

kable(params$output$Clasificacion$ResultadosConglom)


kable(params$output$Clasificacion$Indices)


ggplot(params$output$Clasificacion$DatosConCongl, 
       aes_string(x=Coordenadas[1], y=Coordenadas[2], colour=params$input$NumClust)) + 
  geom_point()


```
