{"version":3,"sources":["webpack://FastMapping/./src/background.js","webpack://FastMapping/external \"electron\"","webpack://FastMapping/external \"electron-log\"","webpack://FastMapping/external \"execa\"","webpack://FastMapping/external \"fs\"","webpack://FastMapping/external \"fs-jetpack\"","webpack://FastMapping/external \"net\"","webpack://FastMapping/external \"path\"","webpack://FastMapping/webpack/bootstrap","webpack://FastMapping/webpack/runtime/compat get default export","webpack://FastMapping/webpack/runtime/define property getters","webpack://FastMapping/webpack/runtime/hasOwnProperty shorthand","webpack://FastMapping/webpack/runtime/make namespace object","webpack://FastMapping/webpack/startup"],"names":["app","session","BrowserWindow","Menu","require","MACOS","WINDOWS","fs","backgroundColor","waitFor","milliseconds","Promise","resolve","_reject","setTimeout","log","info","net","srv","createServer","sock","end","listen","console","address","port","NODER","process","platform","rResources","path","getAppPath","rVer","readdirSync","filter","fn","match","toString","rShinyProcess","shutdown","mainWindow","loadingSplashScreen","errorSplashScreen","createWindow","shinyUrl","width","height","show","icon","fullscreen","frame","titleBarStyle","webPreferences","nodeIntegration","contextIsolation","on","tryStartWebserver","attempt","progressCallback","onErrorStartup","onErrorLater","onSuccess","code","shinyRunning","onError","e","error","shinyProcessAlreadyDead","execa","env","WITHIN_ELECTRON","RHOME","R_HOME_DIR","R_LIBS","R_LIBS_USER","R_LIBS_SITE","R_LIB_PATHS","catch","i","loadURL","webContents","executeJavaScript","then","result","close","kill","splashScreenOptions","createSplashScreen","filename","splashScreen","createLoadingSplashScreen","createErrorScreen","setApplicationMenu","defaultSession","webRequest","onHeadersReceived","_","callback","responseHeaders","emitSpashEvent","event","data","send","destroy","url","quit"],"mappings":"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","file":"background.js","sourcesContent":["/*Some parts of this have been rewritten and/or replaced with \r\ncode from https://github.com/dirkschumacher/r-shiny-electron\r\nMIT License\r\n\r\nCopyright (c) 2018 Dirk Schumacher, Noam Ross, Rich FitzJohn\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.*/\r\n\r\n// Modules to control application life and create native browser window\r\nconst { app, session, BrowserWindow, Menu } = require(\"electron\");\r\n\r\nimport jetpack from \"fs-jetpack\";\r\nimport execa from \"execa\";\r\nimport path from \"path\";\r\n\r\nconst MACOS = \"darwin\";\r\nconst WINDOWS = \"win32\";\r\n\r\nconst fs = require(\"fs\");\r\nconst backgroundColor = \"#2c3e50\";\r\n\r\nconst waitFor = (milliseconds) => {\r\n  return new Promise((resolve, _reject) => {\r\n    setTimeout(resolve, milliseconds);\r\n  });\r\n};\r\n// Log to:\r\n//Linux: ~/.config/<app name>/log.log\r\n//macOS: ~/Library/Logs/<app name>/log.log\r\n//Windows: %USERPROFILE%\\AppData\\Roaming\\<app name>\\log.log\r\nconst log = require(\"electron-log\");\r\nlog.info(\"Application Started\");\r\n\r\n//Find and bind an open port\r\n//Assigned port can be accesssed with srv.address().port\r\nvar net = require(\"net\");\r\nvar srv = net.createServer(function (sock) {\r\n  sock.end(\"Hello world\\n\");\r\n});\r\nsrv.listen(0, function () {\r\n  console.log(\"Listening on port \" + srv.address().port);\r\n});\r\n\r\nlet NODER = null;\r\n// folder above \"bin/RScript\"\r\nif (process.platform == WINDOWS) {\r\n  var rResources = path.join(app.getAppPath(), \"app\", \"r_lang\");\r\n  //Unfortunately on MacOS paths are hardcoded into\r\n  //Rscript but it's in binary so have to use R instead\r\n  NODER = path.join(rResources, \"bin\", \"x64\", \"Rterm.exe\");\r\n}\r\n\r\nif (process.platform == MACOS) {\r\n  var rVer = fs\r\n    .readdirSync(\r\n      path.join(\r\n        app.getAppPath(),\r\n        \"app\",\r\n        \"r_lang\",\r\n        \"Library\",\r\n        \"Frameworks\",\r\n        \"R.framework\",\r\n        \"Versions\"\r\n      )\r\n    )\r\n    .filter((fn) => fn.match(/\\d+\\.(?:\\d+|x)(?:\\.\\d+|x){0,1}/g));\r\n  var rResources = path.join(\r\n    app.getAppPath(),\r\n    \"app\",\r\n    \"r_lang\",\r\n    \"Library\",\r\n    \"Frameworks\",\r\n    \"R.framework\",\r\n    \"Versions\",\r\n    rVer.toString(),\r\n    \"Resources\"\r\n  );\r\n  //Unfortunately on MacOS paths are hardcoded into\r\n  //Rscript but it's in binary so have to use R instead\r\n\r\n  NODER = path.join(rResources, \"bin\", \"R\");\r\n}\r\n\r\nlet rShinyProcess = null;\r\nlet shutdown = false;\r\n// Keep a global reference of the window object, if you don't, the window will\r\n// be closed automatically when the JavaScript object is garbage collected.\r\nlet mainWindow;\r\nlet loadingSplashScreen;\r\nlet errorSplashScreen;\r\n\r\nconst createWindow = (shinyUrl) => {\r\n  mainWindow = new BrowserWindow({\r\n    width: 1200,\r\n    height: 750,\r\n    show: false,\r\n    icon: \"FastMapping.ico\",\r\n    fullscreen: false,\r\n    frame: true,\r\n    titleBarStyle: \"hidden\",\r\n    webPreferences: {\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n    },\r\n  });\r\n  mainWindow.on(\"closed\", () => {\r\n    mainWindow = null;\r\n  });\r\n};\r\n\r\n// tries to start a webserver\r\n// attempt - a counter how often it was attempted to start a webserver\r\n// use the progress call back to listen for intermediate status reports\r\n// use the onErrorStartup callback to react to a critical failure during startup\r\n// use the onErrorLater callback to handle the case when the R process dies\r\n// use onSuccess to retrieve the shinyUrl\r\nconst tryStartWebserver = async (\r\n  attempt,\r\n  progressCallback,\r\n  onErrorStartup,\r\n  onErrorLater,\r\n  onSuccess\r\n) => {\r\n  if (attempt > 3) {\r\n    await progressCallback({\r\n      attempt: attempt,\r\n      code: \"failed\",\r\n    });\r\n    await onErrorStartup();\r\n    return;\r\n  }\r\n\r\n  if (rShinyProcess !== null) {\r\n    await onErrorStartup(); // should not happen\r\n    return;\r\n  }\r\n\r\n  await progressCallback({\r\n    attempt: attempt,\r\n    code: \"start\",\r\n  });\r\n\r\n  let shinyRunning = false;\r\n  const onError = async (e) => {\r\n    console.error(e);\r\n    rShinyProcess = null;\r\n    if (shutdown) {\r\n      // global state :(\r\n      return;\r\n    }\r\n    if (shinyRunning) {\r\n      await onErrorLater();\r\n    } else {\r\n      await tryStartWebserver(\r\n        attempt + 1,\r\n        progressCallback,\r\n        onErrorStartup,\r\n        onErrorLater,\r\n        onSuccess\r\n      );\r\n    }\r\n  };\r\n\r\n  let shinyProcessAlreadyDead = false;\r\n\r\n  rShinyProcess = execa(\r\n    NODER,\r\n    [\r\n      \"--vanilla\",\r\n      \"-e\",\r\n      \"FastMapping::run_app(options = list(port = \" + srv.address().port + \"))\",\r\n    ],\r\n    {\r\n      env: {\r\n        //Necessary for letting R know where it is and ensure we're not using another R\r\n        WITHIN_ELECTRON: \"T\", // can be used within an app to implement specific behaviour\r\n        RHOME: rResources,\r\n        R_HOME_DIR: rResources,\r\n        R_LIBS: path.join(rResources, \"library\"),\r\n        R_LIBS_USER: path.join(rResources, \"library\"),\r\n        R_LIBS_SITE: path.join(rResources, \"library\"),\r\n        R_LIB_PATHS: path.join(rResources, \"library\"),\r\n      },\r\n    }\r\n  ).catch((e) => {\r\n    shinyProcessAlreadyDead = true;\r\n    onError(e);\r\n  });\r\n\r\n  for (let i = 0; i <= 10; i++) {\r\n    if (shinyProcessAlreadyDead) {\r\n      break;\r\n    }\r\n\r\n    try {\r\n      if (shinyRunning === false) {\r\n        mainWindow.loadURL(\"http://127.0.0.1:\" + srv.address().port);\r\n        await waitFor(i * 1000);\r\n\r\n        mainWindow.webContents\r\n          .executeJavaScript(\"window.Shiny.shinyapp.isConnected()\", true)\r\n          .then((result) => {\r\n            shinyRunning = true;\r\n            mainWindow.show();\r\n            loadingSplashScreen.close();\r\n            console.log(\"Trying to connect to Shiny... connected\");\r\n          })\r\n          .catch((result) => {\r\n            if (shinyRunning === false) {\r\n              console.log(\"Trying to connect to Shiny... \" + i);\r\n            }\r\n          });\r\n      }\r\n    } catch (e) {}\r\n  }\r\n  await progressCallback({\r\n    attempt: attempt,\r\n    code: \"notresponding\",\r\n  });\r\n\r\n  try {\r\n    rShinyProcess.kill();\r\n  } catch (e) {}\r\n};\r\n\r\nconst splashScreenOptions = {\r\n  width: 500,\r\n  height: 200,\r\n  frame: false,\r\n  icon: \"FastMapping.ico\",\r\n  backgroundColor: backgroundColor,\r\n};\r\n\r\nconst createSplashScreen = (filename) => {\r\n  let splashScreen = new BrowserWindow(splashScreenOptions);\r\n  splashScreen.loadURL(path.join(app.getAppPath(), \"app\", filename + \".html\"));\r\n  splashScreen.on(\"closed\", () => {\r\n    splashScreen = null;\r\n  });\r\n  return splashScreen;\r\n};\r\n\r\nconst createLoadingSplashScreen = () => {\r\n  loadingSplashScreen = createSplashScreen(\"loading\");\r\n};\r\n\r\nconst createErrorScreen = () => {\r\n  errorSplashScreen = createSplashScreen(\"failed\");\r\n};\r\n\r\n// This method will be called when Electron has finished\r\n// initialization and is ready to create browser windows.\r\n// Some APIs can only be used after this event occurs.\r\napp.on(\"ready\", async () => {\r\n  createWindow();\r\n  // Menu\r\n  // Set null Menu\r\n  Menu.setApplicationMenu(null);\r\n\r\n  // Set a content security policy\r\n  session.defaultSession.webRequest.onHeadersReceived((_, callback) => {\r\n    callback({\r\n      responseHeaders: `\r\n        default-src 'none';\r\n        script-src 'self';\r\n        img-src 'self' data:;\r\n        style-src 'self';\r\n        font-src 'self';\r\n      `,\r\n    });\r\n  });\r\n\r\n  // Deny all permission requests\r\n  /*  session.defaultSession.setPermissionRequestHandler((_1, _2, callback) => {\r\n      callback(false)\r\n    })\r\n  */\r\n  createLoadingSplashScreen();\r\n\r\n  const emitSpashEvent = async (event, data) => {\r\n    try {\r\n      await loadingSplashScreen.webContents.send(event, data);\r\n    } catch (e) {}\r\n  };\r\n\r\n  // pass the loading events down to the loadingSplashScreen window\r\n  const progressCallback = async (event) => {\r\n    await emitSpashEvent(\"start-webserver-event\", event);\r\n  };\r\n\r\n  const onErrorLater = async () => {\r\n    if (!mainWindow) {\r\n      // fired when we quit the app\r\n      return;\r\n    }\r\n    createErrorScreen();\r\n    await errorSplashScreen.show();\r\n    mainWindow.destroy();\r\n  };\r\n\r\n  const onErrorStartup = async () => {\r\n    await waitFor(1000); // TODO: hack, only emit if the loading screen is ready\r\n    await emitSpashEvent(\"failed\");\r\n  };\r\n\r\n  await tryStartWebserver(\r\n    0,\r\n    progressCallback,\r\n    onErrorStartup,\r\n    onErrorLater,\r\n    (url) => {}\r\n  );\r\n});\r\n\r\n// Quit when all windows are closed.\r\napp.on(\"window-all-closed\", () => {\r\n  // On OS X it is common for applications and their menu bar\r\n  // to stay active until the user quits explicitly with Cmd + Q\r\n  // if (process.platform !== 'darwin') {\r\n  // }\r\n  // We overwrite the behaviour for now as it makes things easier\r\n  // remove all events\r\n  shutdown = true;\r\n  app.quit();\r\n\r\n  // kill the process, just in case\r\n  // usually happens automatically if the main process is killed\r\n  try {\r\n    rShinyProcess.kill();\r\n  } catch (e) {}\r\n});\r\n\r\napp.on(\"activate\", () => {\r\n  // On OS X it's common to re-create a window in the app when the\r\n  // dock icon is clicked and there are no other windows open.\r\n  //if (mainWindow === null) {\r\n  //  createWindow()\r\n  //}\r\n  // Deactivated for now\r\n});\r\n","module.exports = require(\"electron\");;","module.exports = require(\"electron-log\");;","module.exports = require(\"execa\");;","module.exports = require(\"fs\");;","module.exports = require(\"fs-jetpack\");;","module.exports = require(\"net\");;","module.exports = require(\"path\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module\n__webpack_require__(\"./src/background.js\");\n// This entry module used 'exports' so it can't be inlined\n"],"sourceRoot":""}